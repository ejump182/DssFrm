import { Layout } from "@/components/docs/Layout";
import { Fence } from "@/components/shared/Fence";
import { Callout } from "@/components/shared/Callout";
import Image from "next/image";

import AddNewZap from "./add-new-zap.png";
import ChooseEvent from "./choose-event.png";
import ConnectWithFB1 from "./connect-with-formbricks-1.png";
import ConnectWithFB2 from "./connect-with-formbricks-2.png";
import DuplicateSurvey from "./duplicate-survey.png";
import SelectSurvey from "./select-survey.png";
import SlackChannelMsg from "./slack-channel-msg.png";
import SlackMsg from "./slack-message.png";
import SubmitTestResponse from "./submit-test-response.png";
import SuccessConnection from "./success-connected.png";
import TestSubmission from "./test-submission.png";
import UpdateQuestionId from "./update-question-id.png";
import ZapierMessage from "./zapier-message.png";

export const meta = {
  title: "Zapier Setup",
  description: "Wire up Formbricks with Zapier and 5000+ other apps",
};

Zapier is a powerful ally. Hook up Formbricks with Zapier and you can send your data to 5000+ other apps. Here is how to do it.

<Callout title="Nail down your survey first" type="note">
  Any changes in the survey cause additional work in the Zap. It makes sense to first settle on the survey you
  want to run and then get to setting up Zapier.
</Callout>

## Step 1: Setup your survey incl. `questionId` for every question

When setting up the Zap your life will be easier when you change the `questionId`s of your survey questions. You can only do so **before** you publish your survey.

<Image src={UpdateQuestionId} alt="Update Question ID" quality="100" className="rounded-lg" />

_In every question card in the Advanced Settings you find the Question ID field. Update it so that you’ll recognize the response tied to this question._

<Callout title="Already published? Duplicate survey" type="note">
  You can only update the questionId when the survey was not yet published. Already published it? Just
  **duplicate it** to update the questionIds.
  <Image src={DuplicateSurvey} alt="Duplicate Survey" quality="100" className="rounded-lg" />
</Callout>

## Step 3: Send a test response

In order to set up Zapier you’ll need a test response. This allows you to select the individual values of each response in your Zap. If you have Formbricks running locally and you want to set up an in-app survey, you can use our [Demo App](/docs/contributing/demo) to trigger a survey and submit a response.

<Image src={SubmitTestResponse} alt="Submit Test Response" quality="100" className="rounded-lg" />

## Step 4: Setup your Zap

Go to [zapier.com](https://zapier.com) and create a new Zap. Search for “Formbricks” to get started:

<Image src={AddNewZap} alt="Add New Zap" quality="100" className="rounded-lg" />

Then, choose the event you want to trigger the Zap on:

<Image src={ChooseEvent} alt="Choose Event" quality="100" className="rounded-lg" />

## Step 5: Connect Formbricks with Zapier

Now, you have to connect Zapier with Formbricks via an API Key:

<Image src={ConnectWithFB1} alt="Connect with Formbricks - 1" quality="100" className="rounded-lg" />
<Image src={ConnectWithFB2} alt="Connect with Formbricks - 2" quality="100" className="rounded-lg" />

Now you need an API key. Please refer to the [API Key Setup](/docs/api/api-key-setup) page to learn how to create one.

Once you copied it in the newly opened Zapier window, you will be connected:

<Image src={SuccessConnection} alt="Successful Connection" quality="100" className="rounded-lg" />

## Step 6: Select Survey

Next, you can choose from all the surveys you have created in this environment:

<Image src={SelectSurvey} alt="Select Survey" quality="100" className="rounded-lg" />

## Step 7: Test your trigger

Once you hit “Test” you will see the three most recent submissions for this survey. If you don’t have any submissions in the survey, submit one to continue setting up your Zap:

<Image src={TestSubmission} alt="Test Submission" quality="100" className="rounded-lg" />
_Now you're happy that you updated the questionId's_

## Step 8: Set up your Zap

Now you have all the data you need at hand. The next steps depend on what you want to do with it. In this tutorial, we will send submissions to a Slack channel:

<Image src={SlackChannelMsg} alt="Slack Channel Message" quality="100" className="rounded-lg" />

In the action itself we can determine the data and layout of the message. Here, we only choose the submission data. You can also refer to the meta data of the submission and the [attributes](/docs/attributes/why) of the person who submitted the survey.

<Image src={SlackMsg} alt="Slack Message" quality="100" className="rounded-lg" />

We now receive a notifcation in our Slack channel whenever a Churn survey is completed:

<Image src={ZapierMessage} alt="Zapier Message" quality="100" className="rounded-lg" />

export default ({ children }) => <Layout meta={meta}>{children}</Layout>;
